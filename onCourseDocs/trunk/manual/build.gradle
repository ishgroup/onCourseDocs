import com.xlson.groovycsv.CsvParser

task extractScripts() {
	def srcFile = file("${rootDir}/manual/schema/script.csv")
	inputs.file srcFile

	def script_dir = file("${buildDir}/scripts")
	script_dir.mkdirs()
	outputs.dir script_dir

	// parse the CSV
	def scripts = CsvParser.parseCsv( srcFile.text )
    
    // write files to disk
    for (s in scripts) {
        def scriptFile = new File("${script_dir}/${s.name}")
        scriptFile.text = s.script
    }
}

task extractTemplates() {
	def srcFile = file("${rootDir}/manual/schema/emailtemplate.csv")
	inputs.file srcFile

	def script_dir = file("${buildDir}/templates")
	script_dir.mkdirs()
	outputs.dir script_dir

	// parse the CSV
	def scripts = CsvParser.parseCsv( srcFile.text )
    
    // write files to disk
    for (s in scripts) {
        def scriptFile = new File("${script_dir}/${s.name}")
        scriptFile.text = s.bodyPlain

        scriptFile = new File("${script_dir}/${s.name}.html")
        scriptFile.text = s.bodyHtml
    }
}

processResources.dependsOn extractScripts
processResources.dependsOn extractTemplates